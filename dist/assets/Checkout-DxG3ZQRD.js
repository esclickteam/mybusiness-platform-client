import{b as g,a as x,u as f,R as o,j as e,A as j}from"./index-D3TBT8UW.js";function y(){const h=g(),{planName:t,totalPrice:r,duration:p}=h.state||{},a=(x()||{}).user,c=f(),[l,i]=o.useState(!1),[d,n]=o.useState("");if(!t||!r)return e.jsxs("div",{className:"checkout-container error-container",children:[e.jsx("h2",{className:"error-message",children:"❌ החבילה שבחרת אינה זמינה."}),e.jsx("a",{className:"return-link",href:"/plans",children:"🔙 חזרה לעמוד החבילות"})]});o.useEffect(()=>{a||c("/login")},[a,c]);const m=async()=>{var u;i(!0),n("");try{console.log("🚀 שליחת בקשת תשלום לשרת:",{plan:t,price:r});const s=await j.post("/api/payments",{plan:t,price:r},{headers:{Authorization:`Bearer ${a==null?void 0:a.token}`}});console.log("✅ תשובת השרת:",s.data),s.data&&s.data.paymentUrl?(console.log("🔗 מעבר לעמוד התשלום:",s.data.paymentUrl),window.location.href=s.data.paymentUrl):(n("❌ שגיאה: השרת לא החזיר כתובת תשלום תקינה."),console.error("❌ שגיאה: השרת לא החזיר כתובת תשלום תקינה.",s.data))}catch(s){n("❌ שגיאה בעת יצירת תשלום. נסה שוב מאוחר יותר."),console.error("❌ שגיאה בתשלום:",((u=s.response)==null?void 0:u.data)||s.message)}finally{i(!1)}};return a?e.jsx("div",{className:"checkout-container",children:e.jsxs("div",{className:"checkout-card",children:[e.jsxs("h1",{children:["🔹 תשלום עבור חבילת ",t]}),e.jsxs("p",{className:"checkout-price",children:["מחיר סופי: ",e.jsxs("strong",{children:[r," ₪"]})]}),e.jsxs("p",{className:"checkout-duration",children:["משך המנוי: ",e.jsxs("strong",{children:[p," חודשים"]})]}),d&&e.jsx("p",{className:"error-message",children:d}),e.jsx("button",{className:"pay-button",onClick:m,disabled:l,children:l?"⏳ מעבד תשלום...":"💳 עבור לתשלום"})]})}):null}export{y as default};
