import{r as t,j as e,u as w,L as k,A as v}from"./index-D3TBT8UW.js";const y=({closePopup:s})=>{const[c,a]=t.useState(""),[m,r]=t.useState(""),[o,n]=t.useState(!1),l=async()=>{if(!c){r("נא להזין כתובת אימייל");return}n(!0);try{console.log("שולח קוד איפוס ל:",c),setTimeout(()=>{r("✅ קוד איפוס נשלח לאימייל שלך!"),n(!1)},1e3)}catch(d){console.error("❌ שגיאה בשליחת קוד איפוס:",d),r("❌ אירעה שגיאה. נסה שוב."),n(!1)}};return e.jsx("div",{className:"forgot-password-overlay",children:e.jsxs("div",{className:"forgot-password-modal",children:[e.jsx("h2",{children:"שחזור סיסמה"}),e.jsx("p",{children:"הזן את כתובת האימייל שלך ונשלח לך קוד לאיפוס הסיסמה"}),e.jsx("input",{type:"email",placeholder:"הזן אימייל",value:c,onChange:d=>a(d.target.value)}),e.jsx("button",{onClick:l,className:"send-button",disabled:o,children:o?"שולח...":"שלח קוד איפוס"}),m&&e.jsx("p",{className:"message",children:m}),e.jsx("button",{onClick:s,className:"close-button",children:"סגור"})]})})},S=()=>{const[s,c]=t.useState({email:"",username:"",password:""}),[a,m]=t.useState(!1),[r,o]=t.useState(!1),[n,l]=t.useState(""),[d,x]=t.useState(!1),i=w(),g=p=>{c({...s,[p.target.name]:p.target.value})},j=async p=>{var f;if(p.preventDefault(),l(""),o(!0),!a&&(!s.email||!s.password)||a&&(!s.username||!s.password)){l("נא למלא את כל השדות"),o(!1);return}try{const h=a?{username:s.username,password:s.password}:{email:s.email,password:s.password},u=await v.post("/auth/login",h,{withCredentials:!0});u.data.token&&localStorage.setItem("token",u.data.token);const b=u.data.user;switch(localStorage.setItem("user",JSON.stringify(b)),b.role){case"business":i("/dashboard");break;case"customer":i("/client-dashboard");break;case"worker":i("/staff/dashboard");break;case"manager":i("/manager/dashboard");break;case"admin":i("/admin/dashboard");break;default:i("/")}}catch(h){const u=(f=h.response)==null?void 0:f.status;l(u===401?"❌ שם משתמש או סיסמה שגויים":"❌ שגיאה בשרת, נסו שוב מאוחר יותר")}finally{o(!1)}};return e.jsxs("div",{className:"login-container",children:[e.jsxs("div",{className:"login-box",children:[e.jsx("h2",{children:a?"כניסת עובדים":"התחברות"}),e.jsxs("form",{onSubmit:j,children:[a?e.jsx("input",{type:"text",name:"username",placeholder:"שם משתמש",value:s.username,onChange:g,autoComplete:"username",required:!0}):e.jsx("input",{type:"email",name:"email",placeholder:"אימייל",value:s.email,onChange:g,autoComplete:"email",required:!0}),e.jsx("input",{type:"password",name:"password",placeholder:"סיסמה",value:s.password,onChange:g,autoComplete:"current-password",required:!0}),e.jsx("button",{type:"submit",className:"login-button",disabled:r,children:r?"🔄 מתחבר...":"התחבר"})]}),n&&e.jsx("p",{className:"error-message",children:n}),e.jsxs("div",{className:"login-links",children:[e.jsx("button",{className:"toggle-login-mode",onClick:()=>{m(!a),l("")},children:a?"🔙 חזרה להתחברות רגילה":"👤 כניסת עובדים / מנהלים / אדמין"}),e.jsx("span",{className:"forgot-link",onClick:()=>x(!0),children:"שכחת את הסיסמה?"}),!a&&e.jsx(k,{to:"/register",className:"register-link",children:"אין לך חשבון? הירשם עכשיו"})]})]}),d&&e.jsx(y,{closePopup:()=>x(!1)})]})};export{S as default};
